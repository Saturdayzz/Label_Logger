<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Label Logger</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            margin: 0;
            padding: 20px;
            margin-bottom: 60px;
        }

        .content {
            flex: 1;
            display: none;
            padding: 20px;
        }
        .content.active {
            display: block;
        }

        h1 {
            color: #000000;
            text-align: center;
            font-family: 'Poppins', sans-serif;
            font-weight: 600; 
            font-size: 45px;
        }

        h2 {
            color: #000000;
            text-align: center;
            font-family: 'Poppins', sans-serif;
            font-weight: 600; 
            font-size: 35px;
        }

        label {
            font-weight: bold;
            color: #000000;
        }

        input[type="text"] {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            width: calc(100% - 12px); /* Ensure the input takes the full width minus padding */
            box-sizing: border-box;
        }

        button {
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: #fff;
            cursor: pointer;
            width: 100%;
            box-sizing: border-box; 
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        button .icon {
            margin-right: 10px;
            width: 20px;
            height: 20px;
        }

        button#button4 {
            background-color: #28a745;
        }

        button:hover {
            background-color: #0056b3; 
        }

        button#button4:hover {
            background-color: #218838;
        }

        button#addRecordButton {
            background-color: #ef414d;
        }

        button#deleteRecordButton {
            background-color: #3591d7;
        }

        button#randomTodoListButton {
            background-color: #00b318;
        }

        button#createScenarioButton {
            background-color: #3591d7;
        }

        #exportButton {
            background-color: #6c757d;
        }

        #exportButton:hover {
            background-color: #5a6268;
        }

        #cancelButton {
            background-color: #dc3545;
        }

        #cancelButton:hover {
            background-color: #c82333;
        }

        .inactive {
            background-color: #d3d3d3 !important;
            color: #000 !important;
            cursor: not-allowed;
        }

        #statusDisplay {
            font-weight: bold;
            margin-top: 20px;
            color: #000000;
        }

        #timeDisplay {
            font-weight: bold;
            margin-top: 20px;
        }

        #currentTimeLabel {
            color: #000000; 
        }
        #currentTime {
            color: #666;
        }

        #currentStatusLabel {
            color: #000000; 
        }
        #currentStatus {
            color: #666;
        }

        #statusImage {
            margin-top: 20px;
            width: 200px;
            height: 200px;
            display: none;
            margin: 0 auto;
        }

        .navbar {
            display: flex;
            justify-content: space-around;
            background-color: #000;
            color: #fff;
            height: 45px;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .navbar button {
            padding: 0;
            margin: 0;
            border: none;
            border-radius: 5px;
            background: none;
            color: inherit;
            font-size: 16px;
            cursor: pointer;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .navbar button:hover {
            background-color: #2b2b2bd8;
            color: #ffffff;
        }

        .navbar img.icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }

        .scenario-item-container {
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .example-row {
            background-color: #ffffcc; 
            color: #000; 
        }
        .selected-row {
            background-color: #d3d3d3; /* 灰色 */
        }
        h1 .icon {
            margin-left: 5px;
            width: 40px;
            height: 40px;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            margin: 10px 0;
            display: flex;
            align-items: center;
        }

        input[type="checkbox"] {
            margin-right: 10px;
        }

        label {
            flex-grow: 1;
        }
        .disabled {
            background-color: #cccccc; 
            color: #999999;
            cursor: not-allowed; 
        }

        #buttonContainer_small {
            display: flex;
            gap: 10px;
        }

        #buttonContainer_small button {
            width: 150px;
            padding: 5px; 
            flex: none;
            background-color: #e1e0e0;
            color: #201f1f;
            font-size: 15px;
        }

        #buttonContainer {
            display: flex;
            gap: 10px;
        }

        #buttonContainer button {
            width: auto; 
            flex: 1; 
        }

        .todo-list {
            list-style-type: none;
            padding: 0;
        }

        .todo-list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #ddd;
            transition: background-color 0.3s ease;
            word-wrap: break-word; 
        }

        .todo-list-item:hover {
            background-color: #f9f9f9;
        }

        .todo-checkbox {
            margin-right: 10px;
        }

        .todo-label {
            flex-grow: 1;
            white-space: pre-wrap;
        }

        .smiley {
            display: inline-block;
            width: 20px;
            height: 20px;
            background-image: url('images/smiley.svg');
            background-size: contain;
            background-repeat: no-repeat;
            margin-left: 10px;
            vertical-align: middle;
        }

        #exportContainer {
            position: absolute;
            top: 20px;
            left: 40px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        #exportIcon {
            width: 24px; 
            height: 24px; 
            margin-right: 5px; 
        }

        #exportText {
            font-family: 'Poppins', sans-serif;
            font-weight: 500; 
            font-size: 15px;
            color: #000;
        }

        #restartContainer {
            position: absolute;
            top: 20px;
            right: 40px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 999;
        }
        .popup {
            display: none;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 80%;
            max-width: 600px;
            max-height: 80%;
            padding: 20px;
            background: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            overflow-y: auto;
        }

        .close-btn {
            position: absolute;
            top: 0px;
            left: 10px;
            width: 20px;
            height: 20px;
            background: none;
            border: none;
            color: #000;
            font-size: 20px;
            cursor: pointer;
        }

        .close-btn:hover {
            background-color: #045184;
            color: #ffffff;
        }

        .new-record-row {
            background-color: rgb(213, 230, 250);
        }

    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha384-dyZ88mC6Up2uqSdhJ8UZ7k8tQ5B3Om0ls0E4x2Rxpocic4Sxj+5LxGEnmJo4e1K" crossorigin="anonymous">
</head>
<body>
    <div id="page1" class="content active">
        <div id="exportContainer" onclick="popInformation()">
            <img id="exportIcon" src="images/information.svg" alt="Export Icon">
            <span id="exportText">About</span>
        </div>

        <div class="popup-overlay" id="popupOverlay" onclick="closePopup()"></div>
        <div class="popup" id="popup">
            <button class="close-btn" onclick="closePopup()">×</button>
            <h2>Information</h2>
            <div id="markdown-content"></div>
        </div>

        <div id="restartContainer" onclick="restart()">
            <img id="exportIcon" src="images/restart.svg" alt="Export Icon">
            <span id="exportText">Restart</span>
        </div>
        <h1>Label Logger</h1>
        <label for="nameInput">Name:</label>
        <input type="text" id="nameInput">
        <br><br>
        <div id="timeDisplay"><span id="currentTimeLabel">Current Time:</span> <span id="currentTime">--:--:--</span></div>
        <div id="statusDisplay"><span id="currentStatusLabel">Current Status: </span> <span id="currentStatus">None</span></div>
        <img id="statusImage" src="" alt="Status Image">
        <button id="button1"><img src="images/indoor.svg" class="icon" alt="Indoor Icon">Indoor</button>
        <button id="button2"><img src="images/outdoor.svg" class="icon" alt="Outdoor Icon">Outdoor</button>
        <button id="button3"><img src="images/semi_indoor.svg" class="icon" alt="Semi-Indoor Icon">Semi-Indoor</button>
        <button id="button4"><img src="images/not_sure.svg" class="icon" alt="Not Sure Icon">Not sure</button>
        <button id="cancelButton"><img src="images/cancel.svg" class="icon" alt="Cancel Icon">Cancel</button>
        <!-- <button id="exportButton"><img src="images/export.svg" class="icon" alt="Export Icon">Export Logs</button> -->
    </div>

    <div id="page2" class="content">
        <div id="exportContainer" onclick="exportLogs()">
            <img id="exportIcon" src="images/export2.svg" alt="Export Icon">
            <span id="exportText">Export</span>
        </div>
        <h2>Log Table</h2>
        <div id="buttonContainer">
            <button id="addRecordButton" onclick="toggleButton()">Add record</button>
            <button id="deleteRecordButton" onclick="toggleButton_delete()">Delete record</button>
        </div>
        <div id="logTable"></div>
    </div>

    <div id="page3" class="content">
        <h2>Embark on Your Data Journey!</h2>
        <div id="buttonContainer">
            <button id="randomTodoListButton">Change Scenario</button>
            <button id="createScenarioButton" onclick="createScenario()">Create a Scenario</button>
        </div>
        
        <div id="todoListContainer"></div>
    </div>
    
    <div class="navbar">
        <button onclick="showPage('page3')"><img src="images/journey2.svg" class="icon" alt="Log Icon">scenario</button>
        <button onclick="showPage('page1')"><img src="images/home.svg" class="icon" alt="Log Icon">home</button>
        <button onclick="showPage('page2')"><img src="images/form.svg" class="icon" alt="Log Icon">log</button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
            var recordName;
            var selectedButton = null;
            var statusDisplay = document.getElementById("statusDisplay");
            var timeDisplay = document.getElementById("timeDisplay");
            var statusImage = document.getElementById("statusImage");
            var buttonLogs = [
            { name: "John Doe", buttonId: "1", buttonLabel: "indoor", date:"15/04/2024",time :"8:31:57",timeZone: "GMT+2", note: "Note 1", isNewRecord: false }
            ];
            var buttonLabels = {
                "1": "indoor",
                "2": "outdoor",
                "3": "semi-indoor",
                "4": "not sure"
            };
    
        //document.addEventListener("DOMContentLoaded", function() {
            const todoLists = [
                { title: "Irchel Campus Scenario 1", items: ["1.Start outdoors in the courtyard", "2.Enter the teaching building and walk into a room staying for >8 minutes", "3.Sit by the window for 5-8 minutes", "4.Walk to the garden between buildings and stay for 5-8 minutes", "5.Walk to the library staying for 5-8 minutes", "6.Walk in Irchel Park for 5-8 minutes"] },
                { title: "Train Station Scenario", items: ["1.Depart from the central train station", "2.Walk through Bahnhofstrasse to Globus", "3 Browse at least four stores in the mall satying 5-8 minutes in each", "4. Stay near the windows for 5-8 minutes before leaving.", "5.Leave Globus and go to Coop‘s supermarket floor staying 5-8 minutes"] },
                { title: "Central Campus Scenario", items: ["1.Start at center campus", "2.Saty at lounge area for >8minutes", "3.Entering a classroom and staying >8minutes", "4.Leave the building and walk to take Polyban", "5.Have a walk in the alley", "6.Have a walk along the Limmatquai"] },
                { title: "Garden Scenario", items: ["1.Start at outside garden", "2.Stay there for 5-8 minutes", "3.Saty inside the house>8 minutes", "4.Stay under the eaves for 5-8 minutes", "5. Walk to the community center and satying for 5-8 minutes","*6.Walk to nearby gym and satying for 5-8 minutes"] },
                { title: "Irchel Campus Scenario 2", items: ["1.Start at Irchel campus", "2. Walk to Irchel bar and stay under the roof for 5-8 minutes", "3.Walk into the cafeteria and stay for 5-8 minutes", "4.Walk to 'Lichthof' and sit there for 5-8 minutes", "5.Get into your office room and stay for 5-8 minutes"] },
                { title: "Central Scenario", items: ["1.Start at a nearby open area", "2.Stay under the station's glass roof for 5 minutes", "3.Take tram 9 to Bellevue", "4. Get off the tram and walk to train station Stadelhofen", "5.Hop on a train to Zurich HB (sit on the lower floor)", "6.Get off the train and stay on the ground floor of Zurich HB"] },
                { title: "Tram 7 Scenario", items: ["1.Start from Milchbuck", "2.Take tram 7 to Schwamendingerplatz", "3.Get off the tram and enter Coop", "4.Stay inside for 5-8 minutes", "5.Enter Migros and stay inside for 5-8 minutes", "6.Leave Schwamendingerplatz by tram"] },
                { title: "City Central Shopping Scenario", items: ["1.Start at Zurich Hb", "2.Walk along Bahnhofstrasse towards Rennweg", "3.Enter 2-3 shops on your way (e.g., Lindt chocolate, clothing stores), stay 5-8 minutes in each shop", "4.Board the tram at Rennweg till Bürkliplatz", "5.Have a 5-minute walk along the lake"] }
            ];

            const todoListContainer = document.getElementById("todoListContainer");
            const randomTodoListButton = document.getElementById("randomTodoListButton");
            let random_buttonClicked = false;
            let todoListIndex = null;
            let todoListTitle = null;

            window.onload = function() {
                showPage('page1');

                //localStorage.removeItem("todosKey");
                var storedName = window.localStorage.getItem("nameKey")? window.localStorage.getItem("nameKey") : "";
                document.getElementById("nameInput").value = storedName;
                recordName = storedName;

                var storedLog = JSON.parse(window.localStorage.getItem("logKey")) ? JSON.parse(window.localStorage.getItem("logKey")) : buttonLogs;                
                buttonLogs = storedLog;

                var storedRandomButtonClicked = JSON.parse(window.localStorage.getItem("clickKey")) ? JSON.parse(window.localStorage.getItem("clickKey")) : false;
                random_buttonClicked = storedRandomButtonClicked;
                var storedTodos = JSON.parse(window.localStorage.getItem("todosKey"));
                var storedTodosTile = JSON.parse(window.localStorage.getItem("todosTitleKey"));
                
                setTimeout(()=>{
                                alert("Welcome to participate in my research!\n\nIf you are new here, please have a look at 'About' (^_−). \nAfter completing data collection for a scenario, please export the log and send to chenxi.jiang@uzh.ch. \n\nEnjoy your journey here!");
                            },300);
            };

                
        /*setInterval(function () {
            // Local Storage
            var storageValue = window.localStorage.getItem("testKey");
            document.getElementById("localStorageData").innerHTML = `Local Storage: ${storageValue || "NULL"}`;
            
            // Cookie
            var cookie = document.cookie.match(`(^|;)\\s*testKey\\s*=\\s*([^;]+)`);
            var cookieValue = cookie ? cookie.pop() : null;
            document.getElementById("cookieData").innerHTML = `Cookie: ${cookieValue || "NULL"}`;
        }, 1000);*/
        
            function saveNameToLocalStorage() {
                var value = recordName;
                window.localStorage.setItem("nameKey", value);
            }

            function saveLogToLocalStorage() {
                var value = buttonLogs;
                window.localStorage.setItem("logKey", JSON.stringify(value));
            }

            function saveTodosToLocalStorage(todos, title, todoListIndex) {
                window.localStorage.setItem("todosKey", JSON.stringify(todos));
                //console.log(window.localStorage.getItem("todosKey"));
                window.localStorage.setItem("todosIndexKey", JSON.stringify(todoListIndex));
                window.localStorage.setItem("todosTitleKey", JSON.stringify(title));
            }

            function saveClickToLocalStorage() {
                window.localStorage.setItem("clickKey", JSON.stringify(random_buttonClicked));
            }

            function restart(){
                if(confirm("Do you decide to restart the experiment? If do so, you will LOSE ALL DATA.")){
                    if(confirm("Again :) Are you sure to delete all data logged?")){
                        localStorage.removeItem("nameKey");
                        localStorage.removeItem("logKey");
                        localStorage.removeItem("todosKey");
                        localStorage.removeItem("todosTitleKey")
                        localStorage.removeItem("todosIndexKey");
                        localStorage.removeItem("clickKey");
                        
                        setTimeout(()=>{
                            alert("You can restart after re-open 'Label Logger'!");
                        },500);
                    }
                }
            }

            function popInformation() {
                document.getElementById('popupOverlay').style.display = 'block';
                document.getElementById('popup').style.display = 'block';
                const markdown = `
### Welcome to MOASIS Data Collection

---

Thank you for participating in my research! This research aims to find an effective method for detecting indoor, outdoor, and semi-indoor activities using GPS and IMU data. This will help to improve indoor-outdoor activity detection for the MOASIS project and have a better understanding of the daily movements of elderly individuals.

In this resarch, I classify the environment to three different types, the definitions are as follows.

**Indoor**: Activities conducted inside a building or enclosed space.

**Outdoor**: Activities conducted outside in the open air.

**Semi-Indoor**: Activities conducted in spaces that are partially enclosed, such as a covered patio or a greenhouse.


---

### Tutorial
Here is a simple introduction. For a more detailed tutorial, please see the tutorial sheet.

- First, please enter your name (you don't have to use your real name).
- Next, click the first icon on the left to get the data collection scenario. You can change your selection once during each data collection.
- Then, you can start collecting data based on the scenario. Click the scenario button to start timing, and switch buttons when you move into a different environment.
- Clicking the same button will stop the current record. You can also cancel the record if it is incorrect. The 'Restart' button clears all cache and data.
- When each data collection is complete, click the 'Export' button to get an Excel file of the log. Then, please send it as an attachment to 'chenxi.jiang@uzh.ch'.

If you have any problem, do not hesitate to contact me! :)

---

**Thank you for your valuable contribution!**
            `;
            document.getElementById("markdown-content").innerHTML = marked.parse(markdown);
            }

            function closePopup() {
                document.getElementById('popupOverlay').style.display = 'none';
                document.getElementById('popup').style.display = 'none';
            }

            ///////////////
            function loadintialTodoList(){
                storedIndex = JSON.parse(window.localStorage.getItem("todosIndexKey"));
                todoListIndex = storedIndex? storedIndex:null;
                console.log(todoListIndex);
                if(todoListIndex){
                    var storedTodos = JSON.parse(window.localStorage.getItem("todosKey"));
                    var storedTodosTile = JSON.parse(window.localStorage.getItem("todosTitleKey"));
                    renderTodoList(storedTodos,storedTodosTile);
                    todoListIndex = JSON.parse(window.localStorage.getItem("todosIndexKey"));
                }else {
                        const { todos,title } = getRandomTodoList();
                        renderTodoList(todos,title);
                    }
            }

        ///////
        function getRandomTodoList(ex_index=null) {
            let randomIndex = Math.floor(Math.random() * todoLists.length);
            if (ex_index != null) {
                do {
                    randomIndex = Math.floor(Math.random() * todoLists.length);
                } while (randomIndex == ex_index);
            }
            todoListIndex = randomIndex;
            return { index: randomIndex + 1, title: todoLists[randomIndex].title, todos: todoLists[randomIndex].items.map(todo => ({ text: todo, completed: false })) };
        }

        function renderTodoList(todos, title) {
            saveTodosToLocalStorage(todos, title, todoListIndex);
            const todoListContainer = document.getElementById("todoListContainer");
            todoListContainer.innerHTML = "";

            const todoListTitle = document.createElement("h3");
            todoListTitle.textContent = title;
            todoListContainer.appendChild(todoListTitle);

            const todoList = document.createElement("div");
            todoList.className = "todo-list";

            todos.forEach((todo, todoIndex) => {
                const todoItem = document.createElement("div");
                todoItem.className = "todo-list-item";

                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.id = `todo-${todoIndex}`;
                checkbox.className = "todo-checkbox";
                checkbox.checked = todo.completed;
                checkbox.addEventListener("change", function() {
                    const label = todoItem.querySelector('.todo-label');

                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                        label.style.color = "gray";

                        const smiley = document.createElement("span");
                        smiley.className = "smiley";
                        label.appendChild(smiley);

                        todos[todoIndex].completed = true;
                        saveTodosToLocalStorage(todos, title, todoListIndex);
                    } else {
                        label.style.textDecoration = "none";
                        label.style.color = "black";

                        const smiley = label.querySelector('.smiley');
                        if (smiley) {
                            label.removeChild(smiley);
                        }
                        todos[todoIndex].completed = false;
                        saveTodosToLocalStorage(todos, title, todoListIndex);
                    }
                    todos[todoIndex].completed = checkbox.checked;
                    saveTodosToLocalStorage(todos, title, todoListIndex);

                    const allChecked = document.querySelectorAll('.todo-checkbox:checked').length === todos.length;
                    if (allChecked) {
                        setTimeout(() => {
                            alert("Congratulation! You completed the data collection, thank you very much! Now please export the log and send to the aassigned mail address.");
                        }, 300);
                    }
                });

                const label = document.createElement("label");
                label.htmlFor = `todo-${todoIndex}`;
                label.textContent = todo.text;
                label.className = "todo-label";
                if (todo.completed) {
                    label.style.textDecoration = "line-through";
                    label.style.color = "gray";

                    const smiley = document.createElement("span");
                    smiley.className = "smiley";
                    label.appendChild(smiley);
                }

                todoItem.appendChild(checkbox);
                todoItem.appendChild(label);
                todoList.appendChild(todoItem);
            });

            todoListContainer.appendChild(todoList);
        }

        randomTodoListButton.addEventListener("click", function() {
            console.log("Button clicked!");
            if (!random_buttonClicked) {
                if (confirm("Are you sure you want to change the to do list? This action can only be performed once.")) {
                    changeRandomButtonColor();
                    const { todos, title } = getRandomTodoList(todoListIndex);
                    renderTodoList(todos, title);
                }
            } else {
                alert("You have already changed the to do list. You cannot perform this action again.");
            }
        });

        function createScenario(){
            const todoListContainer = document.getElementById("todoListContainer");
            todoListContainer.innerHTML = "";

            const titleInput = document.createElement("input");
            titleInput.id = "scenarioTitle";
            titleInput.className = "scenario-item-container";
            titleInput.placeholder = "Scenario Title";
            todoListContainer.appendChild(titleInput);

            const itemsContainer = document.createElement("div");
            itemsContainer.id = "itemsContainer";
            todoListContainer.appendChild(itemsContainer);

            const addItemButton = document.createElement("button");
            addItemButton.textContent = "Add Item";
            addItemButton.addEventListener("click", () => {
                const itemContainer = document.createElement("div");
                itemContainer.className = "scenario-item-container";
                const itemInput = document.createElement("input");
                itemInput.className = "scenario-item";
                itemInput.placeholder = "Scenario Item";
                itemContainer.appendChild(itemInput);
                itemsContainer.appendChild(itemContainer);
            });

            const saveScenarioButton = document.createElement("button");
            saveScenarioButton.textContent = "Save Scenario";
            saveScenarioButton.addEventListener("click", () => {
                const title = document.getElementById("scenarioTitle").value;
                const itemInputs = document.querySelectorAll(".scenario-item");
                todos = Array.from(itemInputs)
                    .map(input => input.value.trim())
                    .filter(value => value !== "")
                    .map(value => ({
                        text: value,
                        completed: false
                }));
                renderTodoList(todos, title);
            });

            const buttonContainer = document.createElement("div");
            buttonContainer.id = "buttonContainer_small";
            todoListContainer.appendChild(buttonContainer);
            buttonContainer.appendChild(addItemButton);
            buttonContainer.appendChild(saveScenarioButton);
        }

        ///////

            /*function getRandomTodoList(ex_index=null) {
                let randomIndex = Math.floor(Math.random() * todoLists.length);
                if (ex_index!=null){
                    do {
                        randomIndex = Math.floor(Math.random() * todoLists.length);
                    } while (randomIndex == ex_index);
                }
                todoListIndex = randomIndex;
                //console.log(todoListIndex);
                return { index: randomIndex + 1, todos: todoLists[randomIndex].map(todo => ({ text: todo, completed: false })) };
            }

            function renderTodoList(todos) {
                saveTodosToLocalStorage(todos,todoListIndex);
                const todoListContainer = document.getElementById("todoListContainer");
                todoListContainer.innerHTML = "";

                const todoList = document.createElement("div");
                todoList.className = "todo-list";

                todos.forEach((todo, todoIndex) => {
                    const todoItem = document.createElement("div");
                    todoItem.className = "todo-list-item";

                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.id = `todo-${todoIndex}`;
                    checkbox.className = "todo-checkbox";
                    checkbox.checked = todo.completed;
                    checkbox.addEventListener("change", function() {
                        const label = todoItem.querySelector('.todo-label');
                        
                        if (checkbox.checked) {
                            label.style.textDecoration = "line-through";
                            label.style.color = "gray";

                            const smiley = document.createElement("span");
                            smiley.className = "smiley";
                            label.appendChild(smiley);
                            
                            todos[todoIndex].completed = true;
                            saveTodosToLocalStorage(todos,todoListIndex);
                            //console.log(todos[todoIndex].completed)
                        } else {
                            label.style.textDecoration = "none";
                            label.style.color = "black";

                            const smiley = label.querySelector('.smiley');
                            if (smiley) {
                                label.removeChild(smiley);
                            }
                            todos[todoIndex].completed = false;
                            saveTodosToLocalStorage(todos,todoListIndex);
                        }
                        todos[todoIndex].completed = checkbox.checked;
                        saveTodosToLocalStorage(todos,todoListIndex);

                        const allChecked = document.querySelectorAll('.todo-checkbox:checked').length === todos.length;
                        if (allChecked) {
                            setTimeout(()=>{
                                alert("Congratulation! You completed the data collection, thank you very much! Now please export the log and send to the aassigned mail address.");
                            },300);
                        }
                    });

                    const label = document.createElement("label");
                    label.htmlFor = `todo-${todoIndex}`;
                    label.textContent = todo.text;
                    label.className = "todo-label";
                    if (todo.completed) {
                        label.style.textDecoration = "line-through";
                        label.style.color = "gray";

                        const smiley = document.createElement("span");
                        smiley.className = "smiley";
                        label.appendChild(smiley);
                    }

                    todoItem.appendChild(checkbox);
                    todoItem.appendChild(label);
                    todoList.appendChild(todoItem);
                });

                todoListContainer.appendChild(todoList);
            } */
        
        function changeRandomButtonColor(){
                    random_buttonClicked = true;
                    randomTodoListButton.disabled = true;
                    randomTodoListButton.classList.add("disabled");
                    saveClickToLocalStorage();
        }

        /*randomTodoListButton.addEventListener("click", function() {
            console.log("Button clicked!");
            if (!random_buttonClicked) {
                if (confirm("Are you sure you want to change the to do list? This action can only be performed once.")) {
                    changeRandomButtonColor();
                    const { todos } = getRandomTodoList(todoListIndex);
                    renderTodoList(todos);
                }
            } else {
                alert("You have already changed the to do list. You cannot perform this action again.");
            }
        });*/

        
    //});


        function showPage(pageId) {
            var pages = document.querySelectorAll('.content');
            pages.forEach(function(page) {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            if (pageId === 'page2') {
                renderLogs();
                var button = document.getElementById('addRecordButton');
                button.innerText = 'Add record';
                button.style.backgroundColor = '';
            } else if (pageId === 'page3') {
                loadintialTodoList();
                if(random_buttonClicked){
                    changeRandomButtonColor();
                }
            }
        }
        
        /*function renderLogs1() {
            //saveToLocalStorage();
            var tableContent = "<table><tr><th>Name</th><th>Id</th><th>Label</th><th>Time</th><th>Note</th></tr>";
            buttonLogs.forEach(function(log, index) {
                var rowClass = index === 0 ? "class='example-row'" : "";
                tableContent += "<tr " + rowClass + "><td>" + log.name + "</td><td>" + log.buttonId + "</td><td>" + log.buttonLabel + "</td><td>" + log.time + "</td><td>" + log.note + "</td></tr>";
            });
            tableContent += "</table>";
            document.getElementById('logTable').innerHTML = tableContent;
        }*/

        function setSortDateTime(date, time) {
            const [month, day, year] = date.split('/');
            return new Date(`${year}-${month}-${day}T${time}`);
        }

        function renderLogs() {
            buttonLogs.sort((a, b) => {
                const dateTimeA = setSortDateTime(a.date, a.time);
                const dateTimeB = setSortDateTime(b.date, b.time);
                return dateTimeA - dateTimeB;
            });

            var tableContent = "<div class='table-container'><table><tr><th>Name</th><th>Id</th><th>Label</th><th>Date</th><th>Time</th><th>TimeZone</th><th>Note</th></tr>";
            buttonLogs.forEach(function(log, index) {
                //var rowClass = index === 0 ? "class='example-row'" : "";
                //var rowClass = log.isNewRecord ? "class='new-record-row'" : "";
                var rowClass = "";
                if (index === 0) {
                    rowClass = "class='example-row'";
                } else if (log.isNewRecord) {
                    rowClass = "class='new-record-row'";
                }
                tableContent += "<tr " + rowClass + " data-index='" + index + "'><td>" + log.name + "</td><td>" + log.buttonId + "</td><td>" + log.buttonLabel + "</td><td>" + log.date+ "</td><td>"+ log.time + "</td><td>"+ log.timeZone + "</td><td>" + log.note + "</td></tr>";
            });
            tableContent += "</table></div>";
            document.getElementById('logTable').innerHTML = tableContent;
            saveLogToLocalStorage();
        }
        
        function toggleButton() {
            var button = document.getElementById('addRecordButton');
            if (button.innerText === 'Add record') {
                if (!recordName){
                    alert("Please input your name at 'Home' page first :)");
                    return;
                }
                addRecord();
                button.innerText = 'Save';
                button.style.backgroundColor = '#1576ff';
            } else {
                saveRecord();
                button.innerText = 'Add record';
                button.style.backgroundColor = ''; 
            }
        }

        function toggleButton_delete() {
            var button = document.getElementById('deleteRecordButton');
            if (button.innerText === 'Delete record') {
                if (!recordName){
                    alert("Please input your name at 'Home' page first :)");
                    return;
                }
                deleteRecord();
                button.innerText = 'Deleting...';
                button.style.backgroundColor = '#f3d157';
            } else {
                renderLogs();
                button.innerText = 'Delete record';
                button.style.backgroundColor = ''; 
            }
        }

        function saveRecord() {
            var name = document.getElementById('nameInput2').value || recordName;
            var buttonId = document.getElementById('buttonIdInput').value;
            var buttonLabel = buttonLabels[buttonId];
            var timezone = document.getElementById('timezoneInput').value;

            var date = setReocrdDate(document.getElementById('dateInput').value);
            var time = document.getElementById('timeInput').value;
            var note = document.getElementById('noteInput').value;

            //var date2 = document.getElementById('dateInput2').value;
            //var time2 = document.getElementById('timeInput2').value;
            //var note2 = document.getElementById('noteInput2').textContent;
            //console.log(`time: ${time}, name: ${name}, buttonId: ${buttonId}`);

            if (!name || !buttonId || !time) {
                alert("Please fill out all required fields.");

                var button = document.getElementById('addRecordButton');
                button.innerText = 'Add record';
                button.style.backgroundColor = ''; 
                renderLogs();

                return;
            }
            buttonLogs.push({ name: name, buttonId: buttonId, buttonLabel: buttonLabel,date:date, time: time,timeZone:timezone,note: note,  isNewRecord: true  });
            //buttonLogs.push({ name: name, buttonId: buttonId, buttonLabel: buttonLabel, date:date2, time: time2,timeZone:timezone, note: note2 });
            renderLogs();
        }

        function setDefaultDate(now=new Date()){
            //var now = new Date();
            var year = now.getFullYear();
            var month = String(now.getMonth() + 1).padStart(2, '0'); 
            var day = String(now.getDate()).padStart(2, '0'); 
            var date = `${year}-${month}-${day}`;
            return date;
        }

        function setReocrdDate(defaultDate){
            var date = new Date(defaultDate)
            date = date.toLocaleDateString('en-GB')
            return date;
        }

        function addRecord() {
            var tableContent = "<table><tr><th>Name</th><th>Id</th><th>Label</th><th>Date</th><th>Time</th><th>TimeZone</th><th>Note</th></tr>";
            buttonLogs.forEach(function(log, index) {
                var rowClass = index === 0 ? "class='example-row'" : "";
                tableContent += "<tr " + rowClass + " data-index='" + index + "'><td>" + log.name + "</td><td>" + log.buttonId + "</td><td>" + log.buttonLabel + "</td><td>" + log.date+ "</td><td>"+ log.time + "</td><td>"+ log.timeZone + "</td><td>" + log.note + "</td></tr>";
            });
            //var nameInputContent = recordName ? `value='${recordName}'` : `placeholder='Name'`;
            //<td><input type='text' id='nameInput2' ${nameInputContent}></td>
            var currentDate = setDefaultDate();
            tableContent += `
                <tr class='new-record-row'>
                    <td><span id='nameInput2'>${recordName}</span></td>
                    <td>
                        <select id='buttonIdInput'>
                            <option value=''>Select an option</option>
                            <option value='1'>Indoor</option>
                            <option value='2'>Outdoor</option>
                            <option value='3'>Semi-indoor</option>
                            <option value='4'>Not sure</option>
                        </select>
                    </td>
                    <td><span id='buttonLabelOutput'></span></td>
                    <td><input type='date' id='dateInput' value='${currentDate}'></td>
                    <td><input type='time' id='timeInput'></td>
                    <td><input type='text' id='timezoneInput' value='GMT+2'></td>
                    <td><input type='text' id='noteInput' placeholder='Note'></td>
                </tr>
            `;
            /*tableContent += `
                <tr>
                    <td><span id='nameInput2'>${recordName}</span></td>
                    <td>
                        <select id='buttonIdInput2'>
                            <option value=''>Select an option</option>
                            <option value='1'>Indoor</option>
                            <option value='2'>Outdoor</option>
                            <option value='3'>Semi-indoor</option>
                            <option value='4'>Not sure</option>
                        </select>
                    </td>
                    <td><span id='buttonLabelOutput2'></span></td>
                    <td><input type='date' id='dateInput2' value='${currentDate}'></td>
                    <td><input type='time' id='timeInput2'></td>
                    <td><input type='text' id='timezoneInput2' value='GMT+2'></td>
                    <td><span id='noteInput2'>Stop</span></td>
                </tr>
            `;*/
            
            tableContent += "</table>";
            document.getElementById('logTable').innerHTML = tableContent;

            // Update button label output based on selected button ID
            document.getElementById('buttonIdInput').addEventListener('change', function() {
                var selectedButtonId = this.value;
                var buttonLabel = buttonLabels[selectedButtonId];
                document.getElementById('buttonLabelOutput').textContent = buttonLabel;
                //document.getElementById('buttonIdInput2').value = selectedButtonId;
                //document.getElementById('buttonLabelOutput2').textContent = buttonLabel;
            });
            /*document.getElementById('buttonIdInput2').addEventListener('change', function() {
                var selectedButtonId = this.value;
                var buttonLabel = buttonLabels[selectedButtonId];
                document.getElementById('buttonLabelOutput').textContent = buttonLabel;
                document.getElementById('buttonIdInput').value = selectedButtonId;
                document.getElementById('buttonLabelOutput2').textContent = buttonLabel;
            });
            document.getElementById('timezoneInput').addEventListener('input', function() {
                var timezone = this.value;
                document.getElementById('timezoneInput2').value = timezone;
            });
            document.getElementById('timezoneInput2').addEventListener('input', function() {
                var timezone = this.value;
                document.getElementById('timezoneInput').value = timezone;
            });*/

        }

        /*function addRecord() {
            if(!recordName){
                var name = prompt("Please input your name:");
                if (!name) return;
            }else{
                name = recordName;
            }

            var buttonId = prompt("Please select environment number. \n1: Indoor, \n2: Outdoor, \n3: Semi-indoor, \n4: Not sure.");
            if (!buttonLabels[buttonId]) {
                alert("Invalid");
                return;
            }

            var start_time = prompt("Please input start time:");
            var end_time = prompt("Please input end time:");
            var note = prompt("Your note:");
            var buttonLabel = buttonLabels[buttonId];

            buttonLogs.push({ name: name, buttonId: buttonId, buttonLabel: buttonLabel, time: start_time, note: note });
            renderLogs();
            buttonLogs.push({ name: name, buttonId: buttonId, buttonLabel: buttonLabel, time: end_time, note: 'Stop' });
            renderLogs();
        } */

        function deleteRecord(){
            alert("Please click the row you want to delete!")
            listenRecordClick();
        }

        function listenRecordClick(){
            var rows = document.querySelectorAll('#logTable tr');
            rows.forEach(function(row, index) {
                if (index > 1) {
                    row.addEventListener('click', function() {
                        raw_classlist = Array.from(this.classList); //obtain original classlist name (may be more than one class)
                        this.classList = '';
                        this.classList.add('selected-row');
                        var rowIndex = this.getAttribute('data-index');
                        //console.log("rowIndex:"+rowIndex);
                        setTimeout(() => {
                            if (confirm("Are you sure you want to delete this record?")) {
                                var delete_rowIndex = rowIndex;
                                deleteRow(delete_rowIndex);
                                listenRecordClick();
                            }else{
                                this.classList.remove('selected-row');
                                console.log(raw_classlist)
                                this.classList.add(raw_classlist);
                            }
                        }, 150);
                    });
                }
            });
        }

        function deleteRow(delete_rowIndex){
            buttonLogs.splice(delete_rowIndex, 1);
            renderLogs();
            return;
        }

        /*function getCurrentTime1() {
            var now = new Date();
            var options = { timeZoneName: 'short' };
            return now.toLocaleString(undefined, options);
        }*/

        function getCurrentTime() {
            var now = new Date();
            var dateString = now.toLocaleDateString('en-GB');
            var timeString = now.toLocaleTimeString('en-GB');
            var timeZoneString = now.toLocaleTimeString('en-US', {timeZoneName: 'short' }).split(' ')[2];
            return { date: dateString, time: timeString, timeZone: timeZoneString };
        }

        function updateTime() {
            var now = new Date();
            var dateString = now.toLocaleDateString('en-GB');
            var timeString = now.toLocaleTimeString('en-GB');
            var timeZoneString = now.toLocaleTimeString('en-US', {timeZoneName: 'short' }).split(' ')[2];
            var dateTimeString = dateString + ' ' + timeString + ' ' + timeZoneString;
            document.getElementById('currentTime').textContent = dateTimeString;
        }

        setInterval(updateTime, 1000);

        function logButtonClick(buttonId, note) {
            var time = getCurrentTime();
            var buttonLabel = buttonLabels[buttonId] || "unknown";
            buttonLogs.push({ buttonId: buttonId, buttonLabel: buttonLabel, date: time.date, time: time.time, timeZone:time.timeZone, name: recordName, note: note, isNewRecord: false });
        }

        function createCsvBlob() {
            let csvContent = "Name,ButtonId,buttonLabel,Time,Note\n";
            buttonLogs.forEach(function(log) {
                csvContent += log.name + "," + log.buttonId + "," + log.buttonLabel + "," + log.time + "," + log.note + "\n";
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });

            return URL.createObjectURL(blob);
        }

        function exportLogs() {
            if (!recordName) {
                alert("Please enter your name before exporting!");
                return;
            }
            
            var csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Name,ButtonId,ButtonLabel,Date,Time,TimeZone,Note\n"; // Add header row

            buttonLogs.forEach(function(log) {
                csvContent += `${log.name},${log.buttonId},${log.buttonLabel},${log.date},${log.time},${log.timeZone},${log.note}\n`;
            });

            var encodedUri = encodeURI(csvContent);
            var link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "label_logs.csv");
            document.body.appendChild(link);

            link.click();
            document.body.removeChild(link);
            //const blobUrl = createCsvBlob();
            //gonative.share.downloadFile({url: blobUrl});
        }

        function handleButtonClick(buttonId, buttonLabel, imageName) {
            if (!recordName) {
                alert("Please enter your name before logging!");
                return;
            }
            if (!todoListIndex) {
                console.log(todoListIndex)
                alert("Please have a look at your scenario before logging!");
                return;
            }

            if (selectedButton === buttonId) {
                if (confirm("Do you want to stop the current status?")) {
                    logButtonClick(buttonId, "Stop");
                    selectedButton = null;
                    currentStatus.textContent= "None";
                    statusImage.style.display = "none";
                    resetButtonStates();
                }
                return;
            }

            if (selectedButton === null){
                if (buttonId == 1){
                    if (!confirm("Do you want to select the status?\n\nIndoor: Activities conducted inside a building or enclosed space.")) {
                    return;
                }}
                else if (buttonId === 2){
                    if (!confirm("Do you want to select the status?\n\nOutdoor: Activities conducted outside in the open air.")) {
                    return;
                }}
                else if (buttonId === 3){
                    if (!confirm("Do you want to select the status?\n\nSemi-Indoor: Activities conducted in spaces that are partially enclosed, such as a covered patio or a greenhouse.")) {
                    return;
                }}
                else if (buttonId === 4){
                    if (!confirm("Do you want to select the status?\n\nNot sure: I am not sure which environment it's belongs to.")) {
                    return;
                }}
            }

            if (selectedButton !== null) {
                if (buttonId == 1){
                    if (!confirm("Current status is ongoing. Do you want to change the status?\n\nIndoor: Activities conducted inside a building or enclosed space.")) {
                    return;
                }}
                else if (buttonId === 2){
                    if (!confirm("Current status is ongoing. Do you want to change the status?\n\nOutdoor: Activities conducted outside in the open air.")) {
                    return;
                }}
                else if (buttonId === 3){
                    if (!confirm("Current status is ongoing. Do you want to change the status?\n\nSemi-Indoor: Activities conducted in spaces that are partially enclosed, such as a covered patio or a greenhouse.")) {
                    return;
                }}
                else if (buttonId === 4){
                    if (!confirm("Current status is ongoing. Do you want to change the status?\n\nNot sure: I am not sure which environment it's belongs to.")) {
                    return;
                }}
            }

            if (buttonId === 4) {
                if (confirm("Are you sure you want to select this option?")) {
                    var note = prompt("Please enter your note:") || "No note";
                    selectedButton = buttonId;
                    logButtonClick(buttonId, note);
                    updateButtonStates();
                    currentStatus.textContent = "You are " + buttonLabel + "!";
                    statusImage.src = imageName;
                    statusImage.style.display = "block";
                }
            } else {
                selectedButton = buttonId;
                logButtonClick(buttonId, "");
                updateButtonStates();
                currentStatus.textContent = "You are " + buttonLabel + "!";
                statusImage.src = imageName;
                statusImage.style.display = "block";
            }
        }

        function updateButtonStates() {
            var buttons = document.querySelectorAll('button[id^="button"]');
            buttons.forEach(function(button) {
                if (parseInt(button.id.replace('button', '')) === selectedButton) {
                    button.classList.remove('inactive');
                } else {
                    button.classList.add('inactive');
                }
            });
        }

        function resetButtonStates() {
            var buttons = document.querySelectorAll('button[id^="button"]');
            buttons.forEach(function(button) {
                button.classList.remove('inactive');
            });
        }

        document.getElementById("button1").addEventListener("click", function() {
            handleButtonClick(1, "Indoor", "images/indoor.png");
        });

        document.getElementById("button2").addEventListener("click", function() {
            handleButtonClick(2, "Outdoor", "images/outdoor.png");
        });

        document.getElementById("button3").addEventListener("click", function() {
            handleButtonClick(3, "Semi-Indoor", "images/semi_indoor.png");
        });

        document.getElementById("button4").addEventListener("click", function() {
            handleButtonClick(4, "Not sure", "images/not_sure.png");
        });

        /*document.getElementById("exportButton").addEventListener("click", function() {
            exportLogs();
        });*/

        document.getElementById("cancelButton").addEventListener("click", function() {
            if (selectedButton === 5 || selectedButton === null) {
                alert("No state now, no need to cancel!")
            }
            else {
                if(confirm("Do you want to cancel the status?\n\nOnly if you selected a wrong button, you need to cancel it. ")) {
                    deleteRow(buttonLogs.length - 1);
                    //logButtonClick(selectedButton, "Cancel");
                    selectedButton = null;
                    currentStatus.textContent = "None";
                    statusImage.style.display = "none";
                    resetButtonStates();}
                }
        });

        document.getElementById("nameInput").addEventListener("change", function() {
            recordName = this.value;
            saveNameToLocalStorage();
        });

        updateTime(); // Initial call to set time immediately
    </script>
</body>
</html>
